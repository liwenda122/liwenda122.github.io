webpackJsonp([32],{3:function(t,e){"use strict";t.exports={post:function(t,e,a){var s=a.$http||this.$http,n=a.$message||this.$message,r=e?{requestData:JSON.stringify(e)}:null;return s({method:"POST",url:t,body:r,emulateJSON:!0}).then(function(t){return t.body}).then(function(t){return 200!=t.code&&n({message:t.message,type:"warning"}),t})},postJSON:function(t,e,a){var s=a.$http||this.$http,n=a.$message||this.$message,r=e?e:null;return s({method:"POST",url:t,body:r,emulateJSON:!0}).then(function(t){return t.body}).then(function(t){return 200!=t.code&&n({message:t.message,type:"warning"}),t})},export:function(t,e){var a=t;for(var s in e)a=a.indexOf("?")==-1?a+"?"+s+"="+e[s]:a+"&"+s+"="+e[s];window.location.href=a},message:function(){}}},491:function(t,e,a){(function(t){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=a(7),r=a(1);s(r);e.default={data:function(){var t=[{path:"/",name:"首页"},{path:"/checkout",name:"结算单"},{path:"/checkout/detail",name:"与供应商结算"},{path:"/checkout/settle/",name:"结算"}],e=[],a={},s={},n={supplierAddress:"",supplierContact:"",supplierId:"",supplierMobile:"",supplierName:"",supplierUseStatus:1},r={mobile:"",purchaserId:"",purchaserName:""},o=[],l=function(t,e,a){return""===e?a(new Error("实付金额不能为空")):void(isNaN(e)?a(new Error("请输入数字值")):parseFloat(e)<0?a(new Error("实付金额必须大于0")):a())};return{crumbs:t,tableData:e,orderData:a,pmsSettlementAmountVo:s,pmsSupplierVo:n,pmsPurchaserVo:r,pmsSettlementTypeVos:o,loading:!0,receiptId:"",role:"1",userid:"",paymentForm:{amount:"",payType:""},rules:{amount:[{validator:l,trigger:"blur"}],payType:[{required:!0,message:"必须选择支付方式",trigger:"change"}]},settlementAccountName:"",settlementAccountNumber:""}},methods:{handleExport:function(){t.export("/pms/settlement/order/detail/export.do",{id:this.userid,receiptId:this.receiptId,settlementReceiver:this.role})},handlePrint:function(){this.$router.push({name:"checkoutViewMaterialPrint",params:{id:this.receiptId,role:this.role,userid:this.userid}})},handleBackToList:function(){this.$router.push({name:"checkoutDetail",params:{id:this.receiptId,role:this.role}})},handleSettle:function(){var t=this;this.$refs.paymentForm.validate(function(e){if(e){var a={receiptId:t.receiptId,id:t.userid,settlementReceiver:t.role,payment:t.paymentForm.amount,settlementTypeId:t.paymentForm.payType};t.$http({url:"/pms/settlement/detail/settle.do",method:"POST",body:{requestData:JSON.stringify(a)},emulateJSON:!0}).then(function(t){return t.body}).then(function(e){200==e.code?(t.$message({message:"结算成功",type:"success"}),t.handleBackToList()):t.$message({message:e.message,type:"warning"})})}})},fetchData:function(){var t=this;this.loading=!0;var e={receiptId:this.receiptId,id:this.userid,settlementReceiver:this.role};this.$http({url:"/pms/settlement/order/data.do",method:"POST",body:{requestData:JSON.stringify(e)},emulateJSON:!0}).then(function(t){return t.body}).then(function(e){200==e.code?t.orderData=e.result:t.$message({message:e.message,type:"warning"})}),this.$http({url:"/pms/settlement/detail/show.do",method:"POST",body:{requestData:JSON.stringify(e)},emulateJSON:!0}).then(function(t){return t.body}).then(function(e){200==e.code?(t.tableData=e.result.pmsSettlementOrderDetailVos,e.result.pmsSupplierVo&&(t.pmsSupplierVo=e.result.pmsSupplierVo),e.result.pmsPurchaserVo&&(t.pmsPurchaserVo=e.result.pmsPurchaserVo),t.pmsSettlementAmountVo=e.result.pmsSettlementAmountVo,e.result.pmsSettlementAmountVo&&e.result.pmsSettlementAmountVo.payment&&parseFloat(e.result.pmsSettlementAmountVo.payment)>0&&(t.paymentForm.amount=e.result.pmsSettlementAmountVo.payment),e.result.pmsSettlementAmountVo&&e.result.pmsSettlementAmountVo.nonPayment&&parseFloat(e.result.pmsSettlementAmountVo.nonPayment)>0&&(t.paymentForm.amount=e.result.pmsSettlementAmountVo.nonPayment),t.pmsSettlementTypeVos=e.result.pmsSettlementTypeVos,0==t.role&&(t.paymentForm.payType="1",t.pmsSettlementTypeVos=[{settlementId:"1",settlementName:"现金"}])):(t.tableData=[],t.$message({message:e.message,type:"warning"})),t.loading=!1})},handleChangePayType:function(t){if(t&&""!=t){var e=this.pmsSettlementTypeVos.findIndex(function(e,a,s){return e.settlementId==t});e!=-1&&(this.settlementAccountName=this.pmsSettlementTypeVos[e].settlementAccountName,this.settlementAccountNumber=this.pmsSettlementTypeVos[e].settlementAccountNumber)}}},created:function(){this.receiptId=this.$route.params.id,this.role=this.$route.params.role,this.userid=this.$route.params.userid,1==this.role?this.crumbs=[{path:"/",name:"首页"},{path:"/checkout",name:"结算单"},{path:"/checkout/detail/"+this.receiptId+"/role/1",name:"与供应商结算"},{path:"/checkout/settle/"+this.receiptId+"/role/1/user/"+this.userid,name:"结算"}]:this.crumbs=[{path:"/",name:"首页"},{path:"/checkout",name:"结算单"},{path:"/checkout/detail/"+this.receiptId+"/role/0",name:"与采购员结算"},{path:"/checkout/settle/"+this.receiptId+"/role/0/user/"+this.userid,name:"结算"}],this.fetchData()},computed:(0,n.mapState)({user:function(t){return t.user}})}}).call(e,a(3))},565:function(t,e,a){e=t.exports=a(4)(),e.push([t.id,".order-bar[data-v-2c092ef8]{color:#99a9bf;font-size:18px;padding:14px 0}.order-bar .right[data-v-2c092ef8]{font-size:14px}.payment-con[data-v-2c092ef8]{padding:20px 0;border-bottom:1px solid #e5e5e5;color:#475669}.payment-con .orange[data-v-2c092ef8]{color:#f60}.payment-con .el-form-item[data-v-2c092ef8]{margin-bottom:0}.payment-con .el-select[data-v-2c092ef8]{width:110px}.payment-con .right[data-v-2c092ef8]{text-align:right}.payment-con .account-info[data-v-2c092ef8]{font-size:14px}.payment-con .account-info .account-num[data-v-2c092ef8]{padding-left:15px}.submit-con[data-v-2c092ef8]{padding:20px 0;color:#475669}.submit-con .right[data-v-2c092ef8]{text-align:right}",""])},625:function(t,e,a){var s,n;a(734),s=a(491);var r=a(681);n=s=s||{},"object"!=typeof s.default&&"function"!=typeof s.default||(n=s=s.default),"function"==typeof n&&(n=n.options),n.render=r.render,n.staticRenderFns=r.staticRenderFns,n._scopeId="data-v-2c092ef8",t.exports=s},681:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("common-layout",{attrs:{crumbs:t.crumbs}},[a("div",{staticClass:"content",slot:"content"},[a("div",{staticClass:"table-content"},[a("div",{staticClass:"order-bar"},[a("el-row",[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"grid-content left"},[t._v("结算")])]),t._v(" "),a("el-col",{attrs:{span:16}},[a("div",{staticClass:"grid-content right"},[a("el-row",[a("el-col",{attrs:{span:10}},[t._v("采购单号："+t._s(t.orderData.purchaseNo))]),t._v(" "),0==t.role?a("el-col",{attrs:{span:6}},[t._v("采购员："+t._s(t.pmsPurchaserVo.purchaserName))]):t._e(),t._v(" "),1==t.role?a("el-col",{attrs:{span:8}},[t._v("供应商："+t._s(t.pmsSupplierVo.supplierName))]):t._e()],1),t._v(" "),a("el-row",[1==t.role?a("el-col",{attrs:{span:10}},[t._v("联系人："+t._s(t.pmsSupplierVo.supplierContact))]):t._e(),t._v(" "),0==t.role?a("el-col",{attrs:{span:6}},[t._v("联系电话："+t._s(t.pmsPurchaserVo.mobile))]):t._e(),t._v(" "),1==t.role?a("el-col",{attrs:{span:8}},[t._v("联系电话："+t._s(t.pmsSupplierVo.supplierMobile))]):t._e()],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[t._v("备注："+t._s(t.orderData.remark))])],1)],1)])],1)],1),t._v(" "),a("div",{staticClass:"button-bar"},[a("el-button",{on:{click:t.handleExport}},[t._v("导出")])],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"element-loading-text":"玩命加载中",data:t.tableData,height:"280",border:""}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"materialName",label:"物料名称","min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"materialTypeName",label:"类别","min-width":"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"receivedCount",label:"收货数量","min-width":"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"purchasePrice",label:"单价（元）","min-width":"120"},inlineTemplate:{render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[t._v(t._s(t.row.purchasePrice))])},staticRenderFns:[]}}),t._v(" "),a("el-table-column",{attrs:{prop:"materialUnitName",label:"单位","min-width":"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalPayment",label:"合计金额（元）","min-width":"140"},inlineTemplate:{render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[t._v(t._s(t.row.totalPayment))])},staticRenderFns:[]}}),t._v(" "),a("el-table-column",{attrs:{prop:"payStatus",label:"是否付款","min-width":"100"},inlineTemplate:{render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-tag",{attrs:{type:0==t.row.payStatus?"primary":"success","close-transition":""}},[t._v(t._s(0==t.row.payStatus?"否":"是"))])},staticRenderFns:[]}})],1),t._v(" "),a("div",{staticClass:"payment-con"},[a("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content left"},[t._v("\n\t\t\t\t\t\t\t\t\t总计："),a("span",{staticClass:"orange"},[t._v(t._s(t.pmsSettlementAmountVo.totalPayment))]),t._v("元\n\t\t\t\t\t\t\t\t")])]),t._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content left"},[t._v("\n\t\t\t\t\t\t\t\t\t已付："),a("span",{staticClass:"orange"},[t._v(t._s(t.pmsSettlementAmountVo.payment))]),t._v("元\n\t\t\t\t\t\t\t\t")])])],1),t._v(" "),a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content left"},[t._v("\n\t\t\t\t\t\t\t\t\t需付："),a("span",{staticClass:"orange"},[t._v(t._s(t.pmsSettlementAmountVo.nonPayment))]),t._v("元\n\t\t\t\t\t\t\t\t")])]),t._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content left"},[t._v("\n\t\t\t\t\t\t\t\t\t数量："),a("span",{staticClass:"orange"},[t._v(t._s(t.pmsSettlementAmountVo.purchaseCount))]),t._v("项\n\t\t\t\t\t\t\t\t")])])],1)],1),t._v(" "),a("el-col",{staticClass:"right",attrs:{span:16}},[a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:24}},[a("el-form",{ref:"paymentForm",attrs:{inline:!0,model:t.paymentForm,rules:t.rules}},[a("el-form-item",{attrs:{label:"实付金额",prop:"amount","label-width":"80px"}},[a("el-input",{directives:[{name:"model",rawName:"v-model.number",value:t.paymentForm.amount,expression:"paymentForm.amount",modifiers:{number:!0}}],attrs:{placeholder:"实付金额"},domProps:{value:t.paymentForm.amount},on:{input:function(e){t.paymentForm.amount=t._n(e)},blur:function(e){t.$forceUpdate()}}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"payType"}},[a("el-select",{directives:[{name:"model",rawName:"v-model",value:t.paymentForm.payType,expression:"paymentForm.payType"}],attrs:{placeholder:"支付方式",disabled:0==t.role},domProps:{value:t.paymentForm.payType},on:{change:t.handleChangePayType,input:function(e){t.paymentForm.payType=e}}},t._l(t.pmsSettlementTypeVos,function(t){return a("el-option",{attrs:{label:t.settlementName,value:t.settlementId}})}))],1)],1)],1)],1),t._v(" "),a("el-row",{staticClass:"account-info",attrs:{type:"flex",justify:"start"}},[""!=t.settlementAccountName?a("el-col",{attrs:{span:24}},[a("span",{staticClass:"account-name"},[t._v("户名："+t._s(t.settlementAccountName))]),t._v(" "),a("span",{staticClass:"account-num"},[t._v("户号："+t._s(t.settlementAccountNumber))])]):t._e()],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"submit-con"},[a("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content right"},[a("el-button",{on:{click:t.handleBackToList}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"orange",loading:t.user.lock},on:{click:t.handleSettle}},[t._v("完成结算")])],1)])],1)],1)],1)])])},staticRenderFns:[]}},734:function(t,e,a){var s=a(565);"string"==typeof s&&(s=[[t.id,s,""]]);a(5)(s,{});s.locals&&(t.exports=s.locals)}});